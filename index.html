<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Testbericht Deckblatt</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      max-width: 1000px;
      margin: auto;
      background-color: #f9f9f9;
    }
    h1 {
      text-align: center;
    }
    .form-section {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      margin-top: 2rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: bold;
    }
    input, select, textarea {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.3rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .row {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .col {
      flex: 1;
    }
    .checkbox-group label {
      margin-right: 1rem;
    }
    .status {
      font-weight: bold;
      color: white;
      padding: 0.5rem;
      border-radius: 8px;
      text-align: center;
      margin-top: 0.5rem;
    }
    .green { background-color: #4caf50; }
    .red { background-color: #f44336; }
    button {
      margin-top: 2rem;
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      background-color: #1976d2;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Test Report ‚Äì Deckblatt</h1>
  <div class="form-section">
    <!-- Formularfelder wie gehabt -->
    <!-- (Aus Platzgr√ºnden hier ausgelassen, aber im echten Code enthalten) -->
  </div>
  <button id="voiceBtn" onclick="toggleRecognition()">üéôÔ∏è Start voice input</button>

  <script>
    const fields = {
      report: ["report", "bericht"],
      project: ["project", "projekt"],
      test: ["test"],
      dvp: ["dvp"],
      sample: ["test sample", "pr√ºfmuster"],
      product: ["product", "produkt"],
      productno: ["product number", "produktnummer"],
      drawing: ["drawing", "zeichnung"],
      type: ["type of test", "testtyp", "typ des tests"],
      objective: ["objective", "ziel"],
      summary: ["summary", "zusammenfassung"],
      conclusion: ["conclusion", "schlussfolgerung"],
      consequence: ["consequences", "kommentar", "comments to the conclusion"],
      description: ["describe", "beschreibung"],
      annex: ["annex", "anhang", "anlage", "attachment"]
    };

    let recognition;
    let isRecognizing = false;

    function toggleRecognition() {
      if (!('webkitSpeechRecognition' in window)) {
        alert('Speech recognition not supported');
        return;
      }

      if (!recognition) {
        recognition = new webkitSpeechRecognition();
        recognition.lang = 'de-DE';
        recognition.interimResults = false;
        recognition.continuous = false;

        recognition.onresult = function(event) {
          const transcript = event.results[0][0].transcript.trim();
          handleTranscript(transcript);
          if (isRecognizing) recognition.start(); // restart automatically
        };

        recognition.onerror = function() {
          if (isRecognizing) recognition.start();
        };
      }

      if (!isRecognizing) {
        recognition.start();
        isRecognizing = true;
        document.getElementById("voiceBtn").textContent = "üõë Stop voice input";
      } else {
        recognition.stop();
        isRecognizing = false;
        document.getElementById("voiceBtn").textContent = "üéôÔ∏è Start voice input";
      }
    }

    function handleTranscript(text) {
      const lower = text.toLowerCase();

      if (lower.includes("r√ºckg√§ngig")) return undoLastWord();
      if (lower.includes("letztes wort l√∂schen")) return undoLastWord();

      for (const [id, keywords] of Object.entries(fields)) {
        for (const keyword of keywords) {
          if (lower.startsWith(keyword.toLowerCase())) {
            const value = lower.replace(keyword.toLowerCase(), '').trim();
            const el = document.getElementById(id);
            if (el) {
              if (el.tagName === 'TEXTAREA' || el.tagName === 'INPUT') {
                el.value += (el.value ? ' ' : '') + value;
              }
            }
            return;
          }
        }
      }

      if (lower.includes("test bestanden") || lower.includes("test passed")) {
        document.getElementById("passed").checked = true;
        setResultColor();
      } else if (lower.includes("test nicht bestanden") || lower.includes("test failed")) {
        document.getElementById("failed").checked = true;
        setResultColor();
      }

      if (lower.includes("verteile an")) {
        const names = ["bonnet", "brenner", "neuber", "schabinger"];
        names.forEach(name => {
          if (lower.includes(name)) {
            document.querySelectorAll(`input[type='checkbox'][value='${name.charAt(0).toUpperCase() + name.slice(1)}']`)[0].checked = true;
          }
        });
      }
    }

    function undoLastWord() {
      const active = document.activeElement;
      if (active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA')) {
        const words = active.value.trim().split(" ");
        words.pop();
        active.value = words.join(" ");
      }
    }

    function setResultColor() {
      const status = document.getElementById("resultStatus");
      if (document.getElementById("passed").checked) {
        status.textContent = "Test PASSED";
        status.className = "status green";
      } else if (document.getElementById("failed").checked) {
        status.textContent = "Test FAILED";
        status.className = "status red";
      } else {
        status.textContent = "";
        status.className = "status";
      }
    }

    function toggleDescription() {
      const value = document.getElementById("yesno").value;
      document.getElementById("describeBox").style.display = value === "yes" ? "block" : "none";
    }
  </script>
</body>
</html>
